






























import { GoogleGenAI } from "@google/genai";































import { ModelType, DetailLevel, GenerationConfig } from "../types";































































export interface ScriptGenerationResult {































  text: string;































  groundingChunks?: any[];































}































































/**































 * Generates an infographic script from source content using the Python ADK Agent.































 */































export const generateScriptFromSource = async (































  source: string,































  config: GenerationConfig































): Promise<ScriptGenerationResult> => {































  try {































    const response = await fetch('/api/generate-script', {































      method: 'POST',































      headers: {































        'Content-Type': 'application/json',































      },































      body: JSON.stringify({































        source_content: source,































        slide_count: config.slideCount,































        detail_level: config.detailLevel,































      }),































    });































































    if (!response.ok) {































      const errorData = await response.json();































      throw new Error(errorData.detail || 'Failed to generate script via ADK Agent');































    }































































    const data = await response.json();































    return {































      text: data.script,































      groundingChunks: [], // Grounding info handling to be added to backend later































    };































  } catch (error: any) {































    console.error("ADK Agent Error:", error);































    throw new Error(`Failed to generate script: ${error.message}`);































  }































};































































/**































 * Generates a visual infographic image for a specific slide script.































 * Supports both Gemini Flash and Gemini Pro image models via generateContent.































 */































export const generateInfographicImage = async (































  prompt: string,































  model: ModelType































): Promise<string> => {































  // Always create a new instance right before making an API call































  const ai = new GoogleGenAI({ apiKey: process.env.API_KEY as string });































  































  try {































    const response = await ai.models.generateContent({































      model: model,































      contents: {































        parts: [































          {































            text: `Create a professional, high-quality infographic image based on this script segment. 































            Ensure all text described is incorporated visually and clearly. 































            The style should be consistent, aesthetic, and professional.































            































            Segment:































            ${prompt}`































          }































        ]































      },































      config: {































        imageConfig: {































          aspectRatio: "16:9",































          ...(model === ModelType.PRO ? { imageSize: "1K" } : {})































        }































      }































    });































































    // Correctly extract the image from potentially multiple response parts































    for (const candidate of response.candidates || []) {































      for (const part of candidate.content.parts) {































        if (part.inlineData) {































          return `data:image/png;base64,${part.inlineData.data}`;































        }































      }































    }































































    throw new Error("No image data found in response");































  } catch (error: any) {































    if (error.message?.includes("Requested entity was not found")) {































      throw new Error("API_KEY_RESET_REQUIRED");































    }































    throw error;































  }































};

















































